<?phpdefine('_JEXEC', 1);// Добавляем здесь столько «прыжков» чтобы прийти в корень сайтаdefine('JPATH_BASE', dirname(__FILE__) . '/../..');// Подключение основных файлов фреймворка Joomla.require_once(JPATH_BASE. '/includes/defines.php');require_once(JPATH_BASE. '/includes/framework.php');// Инициализация приложения, теперь мы можем обращаться к API фреймворкаJFactory::getApplication('site')->initialise();if ($_POST) { 		$session = JFactory::getSession();	$send_params = $session->get('send_params');	$message_items = $session->get('message_items');		$phone = htmlspecialchars($_POST["phone"]); 		$status = '';		if (!$phone) { 		$status = 'Input Phone'; 		echo $status;		die();	}	if(preg_match('/[a-zа-яё]+$/i', $phone)) { 		$status = 'incorrect phone'; 		echo $status;		die();	}	$recaptcha=$_POST['g-recaptcha-response'];    if(!empty($recaptcha)){        $google_url="https://www.google.com/recaptcha/api/siteverify";        $secret='6LfyIxITAAAAAHhVXG2sLgmzr7CycJYV2iwYTMbo';        $ip=$_SERVER['REMOTE_ADDR'];        $url=$google_url."?secret=".$secret."&response=".$recaptcha."&remoteip=".$ip;        $res=getCurlData($url);        $res= json_decode($res, true);        //reCaptcha введена        if($res['success']){			$emails_admins = explode(",", str_replace(" ", "", $send_params->get('email_admin')));			$config = JFactory::getConfig();			$mailer = JFactory::getMailer();			$mailer->setSender(array($config->get('config.mailfrom'), $config->get('config.fromname')));			$mailer->addRecipient($emails_admins);			$mailer->setSubject($send_params->get('subject'));			$mailer->IsHTML(true);			$body = '<b>Имя:</b> ' . $_POST["name"] .'<br />';			$body .= '<b>Email:</b> ' . $_POST["email"] .'<br />';			$body .= '<b>'.$message_items['phone'].'</b> ' . $phone .'<br />';			$body .= '<b>Товар:</b> ' . $_POST["product_name"] .'<br />';			$body .= '<b>Страница:</b> ' . $_POST["product_url"] .'<br />';			if ($message_items['send_time'] != '')				$body .= '<b>'.$message_items['send_time'].'</b> ' . JFactory::getDate()->format ('l, d F Y в h:m:s') .'<br />';			$mailer->setBody($body);			if ($mailer->send()){				echo $status= 'success';			} else { 				echo $status = 'error sending'; 			}		}	} else{		echo $status = 'error_captcha'; 	};	}function getCurlData($url){    $curl = curl_init();    curl_setopt($curl, CURLOPT_URL, $url);    curl_setopt($curl, CURLOPT_RETURNTRANSFER, 1);    curl_setopt($curl, CURLOPT_TIMEOUT, 10);    curl_setopt($curl, CURLOPT_USERAGENT, "Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:1.9.2.16) Gecko/20110319 Firefox/3.6.16");    $curlData = curl_exec($curl);    curl_close($curl);    return $curlData;}?>